# jiyuu/gocovmerge

This tool, `gocovmerge`, merges multiple Go coverage profiles into a single
unified profile.

- [Installation](#installation)
- [Usage](#usage)
- [Options](#options)
- [Requirements](#requirements)
- [How It Works](#how-it-works)
- [Exit Codes](#exit-codes)
- [Common Use Cases](#common-use-cases)
  - [CI/CD Integration](#cicd-integration)
- [Why This Fork?](#why-this-fork)
  - [Makefile Integration](#makefile-integration)
- [License](#license)

## Installation

```bash
go install github.com/Unique-Divine/jiyuu/gocovmerge@latest
```

## Usage

```bash
# Basic usage - merge multiple profiles
gocovmerge -o coverage.total.out profile1.out profile2.out profile3.out

# Using glob patterns
gocovmerge -o total.out coverage.*.out

# Pipeline usage (stdin/stdout)
cat coverage.out | gocovmerge -o - -

# Quiet mode for automation
gocovmerge -q -o merged.out coverage.unit.out coverage.integration.out

# Comma-separated lists (CI-friendly)
gocovmerge -o total.out "coverage.unit.out,coverage.integration.out,coverage.e2e.out"
```

### Options

- `-o <file>`: Output file. Use `-` for stdout (default: stdout)
- `-q`: Quiet mode - suppress non-error output
- `--`: End of options marker

### Requirements

- All input profiles must use the same coverage mode (`set`, `count`, or `atomic`)
- Input files should be valid Go coverage profiles generated by `go test -coverprofile`

### How It Works

The tool merges coverage data by:
- **set mode**: OR's the coverage flags (covered = 1, not covered = 0)
- **count/atomic mode**: Adds the execution counts together
- Maintains file-level organization and block boundaries
- Outputs in standard Go coverage profile format

### Exit Codes

- `0`: Success
- `1`: Usage error (invalid arguments, missing files, etc.)
- `2`: Merge error (incompatible profiles, parsing failures, etc.)

## Common Use Cases

### CI/CD Integration
```bash
# Run different test suites
go test -coverprofile=unit.out ./...
go test -coverprofile=integration.out -tags=integration ./...

# Merge for total coverage
gocovmerge -o coverage.total.out unit.out integration.out

# Generate HTML report
go tool cover -html=coverage.total.out -o coverage.html
```

## Why This Fork?

The original [wadey/gocovmerge](https://github.com/wadey/gocovmerge) hasn't been updated since March 2016 (nearly 10 years). This modernized version provides:

- ✅ Support for Go 1.24+ (uses latest `golang.org/x/tools`)
- ✅ Enhanced CLI with better help text and error messages  
- ✅ Stdin/stdout support for pipeline usage
- ✅ Glob pattern expansion (`coverage.*.out`)
- ✅ Comma-separated file lists for CI convenience
- ✅ Quiet mode flag for cleaner automation
- ✅ Better error handling with specific exit codes
- ✅ Active maintenance and modern Go practices

## License

BSD 2-Clause License (permissive). See [Unique-Divine/jiyuu/gocovmerge/LICENSE.md](https://github.com/Unique-Divine/jiyuu/blob/main/gocovmerge/LICENSE.md)
